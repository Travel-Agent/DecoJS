define("ordnung/utils",[],function(){return{toArray:function(t){for(var n=[],e=t.length>>>0;e--;)n[e]=t[e];return n},extend:function(t,n){n=n||{},t=t||{};for(var e in n)t[e]=n[e];return t},arrayToObject:function(t,n){return t.reduce(function(t,e){return n(e,t),t},{})},trim:function(t,n){for(;t.charAt(0)==n;)t=t.substr(1);for(;t.charAt(t.length-1)==n;)t=t.substr(0,t.length-1);return t},popTail:function(t){return t.slice(0,-1)},startsWith:function(t,n){return t.charAt(0)===n},endsWith:function(t,n){return t.charAt(t.length-1)===n},addEventListener:function(t,n,e,r){"addEventListener"in t?t.addEventListener(n,e,r):t.attachEvent("on"+n,e)}}}),define("ordnung/qvc/ExecutableResult",["ordnung/utils"],function(t){function n(n){this.success=!1,this.valid=!1,this.result=null,this.exception=null,this.violations=[],t.extend(this,n)}return n}),define("ordnung/qvc/Constraint",[],function(){function t(t,n){this.name=t,this.attributes=n,this.message=n.message,this.init(t)}return t.prototype.init=function(t){require(["ordnung/qvc/constraints/"+t],function(t){var n=new t(this.attributes);this.validate=n.isValid.bind(n)}.bind(this))},t.prototype.validate=function(){return!0},t}),define("ordnung/qvc/Validator",["ordnung/qvc/Constraint","knockout"],function(t,n){function e(){this.constraints=[],this.isValid=n.observable(!0),this.message=n.observable("")}return e.prototype.setConstraints=function(n){this.constraints=n.map(function(n){return new t(n.name,n.attributes)})},e.prototype.reset=function(){this.isValid(!0),this.message("")},e.prototype.validate=function(t){0==this.constraints.length?this.reset():this.constraints.every(function(n){return n.validate(t)?!0:(this.isValid(!1),this.message(n.message),!1)}.bind(this))&&(this.isValid(!0),this.message(""))},e}),define("ordnung/qvc/koExtensions",["ordnung/qvc/Validator","knockout"],function(t,n){null!=n&&(n.bindingHandlers.validationMessageFor={init:function(t,e){var r=e(),a=r.validator;a&&n.applyBindingsToNode(t,{hidden:a.isValid,text:a.message},a)}},n.extenders.validation=function(n,e){return n.validator=new t(n,e),n.subscribe(function(t){n.validator.validate(t)}),n},n.bindingHandlers.command=n.bindingHandlers.query={init:function(t,e,r,a){n.applyBindingsToNode(t,{click:e()},a)}})}),define("ordnung/qvc/Validatable",["ordnung/utils","ordnung/qvc/Validator","knockout","ordnung/qvc/koExtensions"],function(t,n,e){function r(t,n){for(var a in t){var i=t[a];e.isObservable(i)&&(i.extend({validation:{}}),n.push(i)),i=e.utils.unwrapObservable(i),"object"==typeof i&&r(i,n)}}function a(t,n,r){return t.split(".").reduce(function(n,a){var i=n.path,o=e.utils.unwrapObservable(n.field);if(a in o)return{field:o[a],path:i+"."+a};throw new Error(r+": "+t+"\n"+a+" is not a member of "+i+"\n"+i+" = `"+e.toJSON(o)+"`")},{field:n,path:"parameters"}).field}function i(t,n,e){var r=a(n,t,"Error applying violation");if(!("string"==typeof e&&"validator"in r))throw new Error("Error applying violation\n"+n+" is not validatable\nit should be an observable");r.validator.isValid(!1),r.validator.message(e)}function o(t,n){t.validator.isValid(!1);var e=t.validator.message(),r=0==e.length?n:e+", "+n;t.validator.message(r)}function s(t,e,a){var i=this;this.validator=new n,this.validatableFields=[],this.validatableParameters=e,r(i.validatableParameters,i.validatableFields),a&&a.applyValidationConstraints(t,i)}return s.prototype.isValid=function(){return this.validatableFields.every(function(t){return t.validator&&t.validator.isValid()})&&this.validator.isValid()},s.prototype.applyViolations=function(t){t.forEach(function(t){var n=t.message,e=t.fieldName;e.length>0?i(this.validatableParameters,e,n):o(this,n)}.bind(this))},s.prototype.applyConstraints=function(t){var n=this.validatableParameters;t.forEach(function(t){var r=t.name,i=t.constraints,o=a(r,n,"Error applying constraints to field");if(!(e.isObservable(o)&&"validator"in o))throw new Error("Error applying constraints to field: "+r+"\n"+"It is not an observable or is not extended with a validator. \n"+r+"=`"+e.toJSON(o)+"`");o.validator.setConstraints(i)})},s.prototype.validate=function(){this.validator.validate(!0),this.validator.isValid()&&this.validatableFields.forEach(function(t){var n=t.validator;n&&n.validate(t())})},s.prototype.clearValidationMessages=function(){this.validator.reset(),this.validatableFields.forEach(function(t){var n=t.validator;n&&n.reset()})},s}),define("ordnung/qvc/Executable",["ordnung/qvc/ExecutableResult","ordnung/qvc/Validatable","ordnung/utils","knockout"],function(t,n,e,r){function a(a,i,o,s,u){var c=this;this.name,this.type,this.isBusy=r.observable(!1),this.hasError=r.observable(!1),this.result=new t,this.parameters={},this.callbacks={beforeExecute:function(){},canExecute:function(){return!0},error:function(){},success:function(){},result:function(){},complete:function(){}},this.execute=function(){c.onBeforeExecute()!==!1&&u.execute(c)},this.onBeforeExecute=function(){return c.isBusy()?!1:(c.hasError(!1),c.callbacks.beforeExecute(),c.validate(),c.isValid()?c.callbacks.canExecute()===!1?!1:(c.isBusy(!0),!0):!1)},this.onError=function(){c.hasError(!0),"violations"in c.result&&c.applyViolations(c.result.violations),c.callbacks.error(c.result)},this.onSuccess=function(){c.hasError(!1),c.clearValidationMessages(),c.callbacks.success(c.result),c.callbacks.result(c.result.result)},this.onComplete=function(){c.hasError()||(c.callbacks.complete(c.result),c.clearValidationMessages()),c.isBusy(!1)},c.name=a,c.type=i,e.extend(c.parameters,o),e.extend(c.callbacks,s),e.extend(c,new n(c.name,c.parameters,u.constraintResolver))}return a.Command="command",a.Query="query",a}),define("ordnung/ajax",[],function(){function t(t){var n=[];for(var e in t){var r=t[e];n.push(e+"="+encodeURIComponent(r))}return n.join("&")}function n(t,n,e){return t+(t.match(/\?/)?t.match(/&$/)?"":"&":"?")+encodeURIComponent(n)+"="+encodeURIComponent(e)}function e(t,n){return t+(t.match(/\/$/)?"":"/")+n}function r(e,r,a,i){var o=new XMLHttpRequest,s="POST"===a,u=null;return r&&(s?u=t(r):e+="?"+t(r)),s&&(e=n(e,"cacheKey",Math.floor(1e4*Math.random()))),o.open(s?"POST":"GET",e,!0),s&&u&&(o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("Content-length",u.length),o.setRequestHeader("Connection","close")),o.onreadystatechange=function(){4==o.readyState&&i(o)},o.send(u),o}return r.addParamToUrl=n,r.addToPath=e,r}),define("ordnung/qvc/ConstraintResolver",[],function(){function t(t,n){for(var e=0;e<n.length;e++)if(n[e].name==t)return n[e];return!1}function n(n,e){var r=t(n,this.constraints);r&&(r.validatables.forEach(function(t){t.applyConstraints(e)}),r.fields=e,r.state="loaded")}function e(t){this.qvc=t,this.constraints=[]}return e.prototype.applyValidationConstraints=function(e,r){var a=t(e,this.constraints);0==a?(this.constraints.push({name:e,state:"loading",validatables:[r]}),this.qvc.loadConstraints(e,n.bind(this))):"loading"===a.state?a.validatables.push(r):r.applyConstraints(a.fields)},e}),define("ordnung/qvc",["ordnung/qvc/Executable","ordnung/qvc/ExecutableResult","ordnung/utils","ordnung/ajax","ordnung/qvc/ConstraintResolver","knockout","ordnung/qvc/koExtensions"],function(t,n,e,r,a,i){function o(){var t=this;this.constraintResolver=new a(t),this.execute=function(e){var a=i.toJS(e.parameters),o={parameters:JSON.stringify(a),csrfToken:t.config.csrf},s=r.addToPath(t.config.baseUrl,e.type+"/"+e.name);r(s,o,"POST",function(t){200===t.status?(e.result=new n(JSON.parse(t.responseText||"{}")),e.result.success===!0?e.onSuccess():e.onError()):(e.result=new n({exception:{message:t.responseText,cause:t}}),e.onError()),e.onComplete()})},this.loadConstraints=function(n,e){var a=r.addToPath(t.config.baseUrl,"constraints/"+n);r(a,null,"GET",function(t){if(200===t.status){try{var r=JSON.parse(t.responseText||'{"parameters":[]}');0=="parameters"in r&&(r.parameters=[])}catch(a){var r={parameters:[]}}e(n,r.parameters)}})},this.config={baseUrl:"/",csrf:""}}function s(n,e,r,a){if(null==n||0==n.length)throw new Error(e+" is missing name\nA "+e+" must have a name!\nusage: createCommand('name', [parameters, callbacks])");var o=new t(n,e,r||{},a||{},u),s=o.execute.bind(o);return s.isValid=i.computed(function(){return o.isValid()}),s.isBusy=i.computed(function(){return o.isBusy()}),s.hasError=i.computed(function(){return o.hasError()}),s.success=function(t){return o.callbacks.success=t,s},s.error=function(t){return o.callbacks.error=t,s},s.beforeExecute=function(t){return o.callbacks.beforeExecute=t,s},s.canExecute=function(t){return o.callbacks.canExecute=t,s},s.result=function(){return 1==arguments.length?(o.callbacks.result=arguments[0],s):o.result.result},s.complete=function(t){return o.callbacks.complete=t,s},s.clearValidationMessages=o.clearValidationMessages.bind(o),s}var u=new o;return{createCommand:function(n,e,r){return s(n,t.Command,e,r)},createQuery:function(n,e,r){return s(n,t.Query,e,r)},config:function(t){e.extend(u.config,t)}}}),define("ordnung/spa/Outlet",["knockout"],function(t){function n(t,n){this.element=t,this.document=n||window.document}return n.prototype.unloadCurrentPage=function(){t.cleanNode(this.element),this.element.innerHTML=""},n.prototype.setPageContent=function(t){this.element.innerHTML=t},n.prototype.getPageTitle=function(){var t=this.element.querySelector("meta[name=title]");return t&&t.getAttribute("content")},n.prototype.setDocumentTitle=function(t){this.document.title=t},n.prototype.extractAndRunPageJavaScript=function(){for(var t=this.element.querySelectorAll("script"),n=0;n<t.length;n++){if(t[n].parentNode.removeChild(t[n]),""===t[n].id)throw new Error("The script must have an id");if(null==this.document.getElementById(t[n].id)){var e=this.document.createElement("script");e.id=t[n].id,e.text=t[n].textContent,this.document.body.appendChild(e)}}},n.prototype.indicatePageIsLoading=function(){this.element.setAttribute("data-loading","true")},n.prototype.pageHasLoaded=function(){this.element.setAttribute("data-loading","false")},n}),define("ordnung/spa/applyViewModels",["ordnung/utils","knockout","when","when/callbacks"],function(t,n,e,r){function a(t){var n=t.getAttribute("data-viewmodel"),e=t.getAttribute("data-model");return e&&0==e.indexOf("{")&&(e=JSON.parse(e)),{target:t,viewModelName:n,model:e}}function i(t){return r.call(require,[t.viewModelName]).then(function(n){return t.ViewModel=n,t})}function o(t,e){var r=new e.ViewModel(e.model,t);n.applyBindings(r,e.target)}return function(n,r){n=n||document.body;var s=t.toArray(n.querySelectorAll("*[data-viewmodel]")),u=s.map(a).map(i);return e.all(u).then(function(t){t.forEach(o.bind(null,r))})}}),define("ordnung/spa/hashNavigation",["ordnung/utils"],function(t){function n(n,e,r){var a=t.startsWith(e,"/"),i=t.endsWith(e,"/");if("/"==e)var o=[];else var o=t.trim(e,"/").split("/");return i&&o.push(r),a?o:t.popTail(n).concat(o)}function e(e,r,a){var i=t.trim(a.location.hash,"#");if(t.startsWith(i,"/"))this.currentPath=n(this.currentPath,i,e.index),r(this.currentPath.join("/"));else{var o=n(this.currentPath,i,e.index).join("/");a.location.replace("#/"+o)}}function r(n,r,a,i){a=a||document,i=i||window;var o={currentPath:[]},s=e.bind(o,n,r,a);return s(),t.addEventListener(i,"hashchange",s,!1),{stop:function(){i.removeEventListener("hashchange",s,!1)}}}return{start:r}}),define("ordnung/spa/PageLoader",["ordnung/ajax"],function(t){function n(t){this.pathToUrl=t,this.currentXHR=null}return n.prototype.loadPage=function(n,e){this.abort(),this.currentXHR=t(this.pathToUrl(n),{},"GET",function(t){200===t.status?e.resolve(t.responseText):e.reject(t.responseText)})},n.prototype.abort=function(){this.currentXHR&&4!==this.currentXHR.readyState&&this.currentXHR.abort()},n}),define("ordnung/spa/Templates",["ordnung/spa/PageLoader","ordnung/utils","when"],function(t,n,e){function r(t){var e=t.querySelectorAll("[type='text/page-template']"),r=n.toArray(e),a=r.map(function(t){return{id:t.id.toLowerCase(),content:t.innerHTML}});return n.arrayToObject(a,function(t,n){n[t.id]=t.content})}function a(n,e){this.pageLoader=new t(e&&e.pathToUrl||function(t){return t}),this.templates=r(n)}return a.prototype.getTemplate=function(t){var n=e.defer();this.pageLoader.abort();var r=t.toLowerCase();return r in this.templates?n.resolve(this.templates[r]):this.pageLoader.loadPage(t,n.resolver),n.promise},a}),define("ordnung/spa",["ordnung/spa/Outlet","ordnung/spa/applyViewModels","ordnung/spa/hashNavigation","ordnung/spa/Templates","ordnung/utils"],function(t,n,e,r,a){function i(t){return d.unloadCurrentPage(),d.setPageContent(t),d.setDocumentTitle(d.getPageTitle()||f),d.extractAndRunPageJavaScript(),n(d.element,u)}function o(t){return d.indicatePageIsLoading(),s(),h.getTemplate(t).then(i).then(function(){d.pageHasLoaded()})}function s(){for(var t;t=v.pop();)t()}function u(t,n){v.push(function(){t.dont(n)}),t(n)}function c(i,s){return l=s||window.document,p=a.extend(p,i),d=new t(l.querySelector("[data-outlet]"),l),f=s.title,h=new r(l,p),n(l,u).then(function(){e.start(p,o,l)})}var l,d,f,h,p={index:"index"},v=[];return{start:c}}),define("ordnung/proclaimWhen.js",[],function(){function t(t,n,e){n.subscribers.forEach(function(t){t.apply(t,e)})}function n(t,n,e){n.subscribers.push(e)}function e(t,n,e){var r=n.subscribers.indexOf(e);n.subscribers.splice(r,1)}function r(r,a){a.subscribers=[];var i=function(){1==arguments.length&&"function"==typeof arguments[0]?n(r,a,arguments[0]):t(r,a,arguments)};return i.dont=function(t){e(r,a,t)},i}function a(t){for(var n in t)t[n]=r(n,t[n]);return t}function i(t,n){return n?r(t,n):r("anonymous event",t)}return{extend:a,create:i}});
//# sourceMappingURL=ordnung.js.map