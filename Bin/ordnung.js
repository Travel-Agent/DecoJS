define("ordnung/utils",[],function(){return{toArray:function(t){for(var e=[],n=t.length>>>0;n--;)e[n]=t[n];return e},extend:function(t,e){e=e||{},t=t||{};for(var n in e)t[n]=e[n];return t},arrayToObject:function(t,e){return t.reduce(function(t,n){return e(n,t),t},{})},trim:function(t,e){for(;t.charAt(0)==e;)t=t.substr(1);for(;t.charAt(t.length-1)==e;)t=t.substr(0,t.length-1);return t},popTail:function(t){return t.slice(0,-1)},startsWith:function(t,e){return t.charAt(0)===e},endsWith:function(t,e){return t.charAt(t.length-1)===e},addEventListener:function(t,e,n,r){"addEventListener"in t?t.addEventListener(e,n,r):t.attachEvent("on"+e,n)}}}),define("ordnung/qvc/ExecutableResult",["ordnung/utils"],function(t){function e(e){this.success=!1,this.valid=!1,this.result=null,this.exception=null,this.violations=[],t.extend(this,e)}return e}),define("ordnung/qvc/Constraint",[],function(){function t(t,e){this.name=t,this.attributes=e,this.message=e.message,this.init(t)}return t.prototype.init=function(t){require(["ordnung/qvc/constraints/"+t],function(t){var e=new t(this.attributes);this.validate=e.isValid.bind(e)}.bind(this))},t.prototype.validate=function(){return!0},t}),define("ordnung/qvc/Validator",["ordnung/qvc/Constraint","knockout"],function(t,e){function n(){this.constraints=[],this.isValid=e.observable(!0),this.message=e.observable("")}return n.prototype.setConstraints=function(e){this.constraints=e.map(function(e){return new t(e.name,e.attributes)})},n.prototype.reset=function(){this.isValid(!0),this.message("")},n.prototype.validate=function(t){0==this.constraints.length?this.reset():this.constraints.every(function(e){return e.validate(t)?!0:(this.isValid(!1),this.message(e.message),!1)}.bind(this))&&(this.isValid(!0),this.message(""))},n}),define("ordnung/qvc/koExtensions",["ordnung/qvc/Validator","knockout"],function(t,e){null!=e&&(e.bindingHandlers.validationMessageFor={init:function(t,n){var r=n(),a=r.validator;a&&e.applyBindingsToNode(t,{hidden:a.isValid,text:a.message},a)}},e.extenders.validation=function(e,n){return e.validator=new t(e,n),e.subscribe(function(t){e.validator.validate(t)}),e},e.bindingHandlers.command=e.bindingHandlers.query={init:function(t,n,r,a){e.applyBindingsToNode(t,{click:n()},a)}})}),define("ordnung/qvc/Validatable",["ordnung/utils","ordnung/qvc/Validator","knockout","ordnung/qvc/koExtensions"],function(t,e,n){function r(t,e){for(var a in t){var i=t[a];n.isObservable(i)&&(i.extend({validation:{}}),e.push(i)),i=n.utils.unwrapObservable(i),"object"==typeof i&&r(i,e)}}function a(t,e,r){return t.split(".").reduce(function(e,a){var i=e.path,o=n.utils.unwrapObservable(e.field);if(a in o)return{field:o[a],path:i+"."+a};throw new Error(r+": "+t+"\n"+a+" is not a member of "+i+"\n"+i+" = `"+n.toJSON(o)+"`")},{field:e,path:"parameters"}).field}function i(t,e,n){var r=a(e,t,"Error applying violation");if(!("string"==typeof n&&"validator"in r))throw new Error("Error applying violation\n"+e+" is not validatable\nit should be an observable");r.validator.isValid(!1),r.validator.message(n)}function o(t,e){t.validator.isValid(!1);var n=t.validator.message(),r=0==n.length?e:n+", "+e;t.validator.message(r)}function s(t,n,a){var i=this;this.validator=new e,this.validatableFields=[],this.validatableParameters=n,r(i.validatableParameters,i.validatableFields),a&&a.applyValidationConstraints(t,i)}return s.prototype.isValid=function(){return this.validatableFields.every(function(t){return t.validator&&t.validator.isValid()})&&this.validator.isValid()},s.prototype.applyViolations=function(t){t.forEach(function(t){var e=t.message,n=t.fieldName;n.length>0?i(this.validatableParameters,n,e):o(this,e)}.bind(this))},s.prototype.applyConstraints=function(t){var e=this.validatableParameters;t.forEach(function(t){var r=t.name,i=t.constraints,o=a(r,e,"Error applying constraints to field");if(!(n.isObservable(o)&&"validator"in o))throw new Error("Error applying constraints to field: "+r+"\n"+"It is not an observable or is not extended with a validator. \n"+r+"=`"+n.toJSON(o)+"`");o.validator.setConstraints(i)})},s.prototype.validate=function(){this.validator.validate(!0),this.validator.isValid()&&this.validatableFields.forEach(function(t){var e=t.validator;e&&e.validate(t())})},s.prototype.clearValidationMessages=function(){this.validator.reset(),this.validatableFields.forEach(function(t){var e=t.validator;e&&e.reset()})},s}),define("ordnung/qvc/Executable",["ordnung/qvc/ExecutableResult","ordnung/qvc/Validatable","ordnung/utils","knockout"],function(t,e,n,r){function a(a,i,o,s,u){var c=this;this.name,this.type,this.isBusy=r.observable(!1),this.hasError=r.observable(!1),this.result=new t,this.parameters={},this.callbacks={beforeExecute:function(){},canExecute:function(){return!0},error:function(){},success:function(){},result:function(){},complete:function(){}},this.execute=function(){c.onBeforeExecute()!==!1&&u.execute(c)},this.onBeforeExecute=function(){return c.isBusy()?!1:(c.hasError(!1),c.callbacks.beforeExecute(),c.validate(),c.isValid()?c.callbacks.canExecute()===!1?!1:(c.isBusy(!0),!0):!1)},this.onError=function(){c.hasError(!0),"violations"in c.result&&c.applyViolations(c.result.violations),c.callbacks.error(c.result)},this.onSuccess=function(){c.hasError(!1),c.clearValidationMessages(),c.callbacks.success(c.result),c.callbacks.result(c.result.result)},this.onComplete=function(){c.hasError()||(c.callbacks.complete(c.result),c.clearValidationMessages()),c.isBusy(!1)},c.name=a,c.type=i,n.extend(c.parameters,o),n.extend(c.callbacks,s),n.extend(c,new e(c.name,c.parameters,u.constraintResolver))}return a.Command="command",a.Query="query",a}),define("ordnung/ajax",[],function(){function t(t){var e=[];for(var n in t){var r=t[n];e.push(n+"="+encodeURIComponent(r))}return e.join("&")}function e(t,e,n){return t+(t.match(/\?/)?t.match(/&$/)?"":"&":"?")+encodeURIComponent(e)+"="+encodeURIComponent(n)}function n(t,e){return t+(t.match(/\/$/)?"":"/")+e}function r(n,r,a,i){var o=new XMLHttpRequest,s="POST"===a,u=null;return r&&(s?u=t(r):n+="?"+t(r)),s&&(n=e(n,"cacheKey",Math.floor(1e4*Math.random()))),o.open(s?"POST":"GET",n,!0),s&&u&&(o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("Content-length",u.length),o.setRequestHeader("Connection","close")),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.onreadystatechange=function(){4==o.readyState&&i(o)},o.send(u),o}return r.addParamToUrl=e,r.addToPath=n,r}),define("ordnung/qvc/ConstraintResolver",[],function(){function t(t,e){for(var n=0;n<e.length;n++)if(e[n].name==t)return e[n];return!1}function e(e,n){var r=t(e,this.constraints);r&&(r.validatables.forEach(function(t){t.applyConstraints(n)}),r.fields=n,r.state="loaded")}function n(t){this.qvc=t,this.constraints=[]}return n.prototype.applyValidationConstraints=function(n,r){var a=t(n,this.constraints);0==a?(this.constraints.push({name:n,state:"loading",validatables:[r]}),this.qvc.loadConstraints(n,e.bind(this))):"loading"===a.state?a.validatables.push(r):r.applyConstraints(a.fields)},n}),define("ordnung/qvc",["ordnung/qvc/Executable","ordnung/qvc/ExecutableResult","ordnung/utils","ordnung/ajax","ordnung/qvc/ConstraintResolver","knockout","ordnung/qvc/koExtensions"],function(t,e,n,r,a,i){function o(){var t=this;this.constraintResolver=new a(t),this.execute=function(n){var a=i.toJS(n.parameters),o={parameters:JSON.stringify(a),csrfToken:t.config.csrf},s=r.addToPath(t.config.baseUrl,n.type+"/"+n.name);r(s,o,"POST",function(t){200===t.status?(n.result=new e(JSON.parse(t.responseText||"{}")),n.result.success===!0?n.onSuccess():n.onError()):(n.result=new e({exception:{message:t.responseText,cause:t}}),n.onError()),n.onComplete()})},this.loadConstraints=function(e,n){var a=r.addToPath(t.config.baseUrl,"constraints/"+e);r(a,null,"GET",function(t){if(200===t.status){try{var r=JSON.parse(t.responseText||'{"parameters":[]}');0=="parameters"in r&&(r.parameters=[])}catch(a){var r={parameters:[]}}n(e,r.parameters)}})},this.config={baseUrl:"/",csrf:""}}function s(e,n,r,a){if(null==e||0==e.length)throw new Error(n+" is missing name\nA "+n+" must have a name!\nusage: createCommand('name', [parameters, callbacks])");var o=new t(e,n,r||{},a||{},u),s=o.execute.bind(o);return s.isValid=i.computed(function(){return o.isValid()}),s.isBusy=i.computed(function(){return o.isBusy()}),s.hasError=i.computed(function(){return o.hasError()}),s.success=function(t){return o.callbacks.success=t,s},s.error=function(t){return o.callbacks.error=t,s},s.beforeExecute=function(t){return o.callbacks.beforeExecute=t,s},s.canExecute=function(t){return o.callbacks.canExecute=t,s},s.result=function(){return 1==arguments.length?(o.callbacks.result=arguments[0],s):o.result.result},s.complete=function(t){return o.callbacks.complete=t,s},s.clearValidationMessages=o.clearValidationMessages.bind(o),s}var u=new o;return{createCommand:function(e,n,r){return s(e,t.Command,n,r)},createQuery:function(e,n,r){return s(e,t.Query,n,r)},config:function(t){n.extend(u.config,t)}}}),define("ordnung/spa/Outlet",["knockout"],function(t){function e(t,e){this.element=t,this.document=e||window.document}return e.prototype.unloadCurrentPage=function(){t.cleanNode(this.element),this.element.innerHTML=""},e.prototype.setPageContent=function(t){this.element.innerHTML=t},e.prototype.getPageTitle=function(){var t=this.element.querySelector("meta[name=title]");return t&&t.getAttribute("content")},e.prototype.setDocumentTitle=function(t){this.document.title=t},e.prototype.extractAndRunPageJavaScript=function(){for(var t=this.element.querySelectorAll("script"),e=0;e<t.length;e++){if(t[e].parentNode.removeChild(t[e]),""===t[e].id)throw new Error("The script must have an id");if(null==this.document.getElementById(t[e].id)){var n=this.document.createElement("script");n.id=t[e].id,n.text=t[e].textContent,this.document.body.appendChild(n)}}},e.prototype.indicatePageIsLoading=function(){this.element.setAttribute("data-loading","true")},e.prototype.pageHasLoaded=function(){this.element.setAttribute("data-loading","false")},e}),define("ordnung/spa/applyViewModels",["ordnung/utils","knockout","when","when/callbacks"],function(t,e,n,r){function a(t){var e=t.getAttribute("data-viewmodel"),n=t.getAttribute("data-model");return n&&0==n.indexOf("{")&&(n=JSON.parse(n)),{target:t,viewModelName:e,model:n}}function i(t){return r.call(require,[t.viewModelName]).then(function(e){return t.ViewModel=e,t})}function o(t,n){var r=new n.ViewModel(n.model,t);e.applyBindings(r,n.target)}return function(e,r){e=e||document.body;var s=t.toArray(e.querySelectorAll("*[data-viewmodel]")),u=s.map(a).map(i);return n.all(u).then(function(t){t.forEach(o.bind(null,r))})}}),define("ordnung/spa/hashNavigation",["ordnung/utils"],function(t){function e(e,n,r){var a=t.startsWith(n,"/")===!1,i=t.endsWith(n,"/");if("/"===n)var o=[];else if(""===n)var o=[r];else var o=t.trim(n,"/").split("/");i&&o.push(r),a&&(o=t.popTail(e).concat(o));for(var s=[],u=o.length>>>0;u--;)""!==o[u]&&"."!==o[u]&&(".."===o[u]?u--:s.unshift(o[u]));return s}function n(n,r,a){var i=t.trim(a.location.hash,"#"),o=0==t.startsWith(i,"/"),s=t.endsWith(i,"/");if(o||s){var u=e(this.currentPath,i,n.index).join("/");a.location.replace("#/"+u)}else this.currentPath=e(this.currentPath,i,n.index),r(this.currentPath.join("/"))}function r(e,r,a,i){a=a||document,i=i||window;var o={currentPath:[]},s=n.bind(o,e,r,a);return s(),t.addEventListener(i,"hashchange",s,!1),{stop:function(){i.removeEventListener("hashchange",s,!1)}}}return{start:r}}),define("ordnung/spa/PageLoader",["ordnung/ajax"],function(t){function e(t){this.pathToUrl=t,this.currentXHR=null}return e.prototype.loadPage=function(e,n){this.abort(),this.currentXHR=t(this.pathToUrl(e),{},"GET",function(t){200===t.status?n.resolve(t.responseText):n.reject(t.responseText)})},e.prototype.abort=function(){this.currentXHR&&4!==this.currentXHR.readyState&&this.currentXHR.abort()},e}),define("ordnung/spa/Templates",["ordnung/spa/PageLoader","ordnung/utils","when"],function(t,e,n){function r(t){var n=t.querySelectorAll("[type='text/page-template']"),r=e.toArray(n),a=r.map(function(t){return{id:t.id.toLowerCase(),content:t.innerHTML}});return e.arrayToObject(a,function(t,e){e[t.id]=t.content})}function a(e,n){this.pageLoader=new t(n&&n.pathToUrl||function(t){return t}),this.templates=r(e)}return a.prototype.getTemplate=function(t){var e=n.defer();this.pageLoader.abort();var r=t.toLowerCase();return r in this.templates?e.resolve(this.templates[r]):this.pageLoader.loadPage(t,e.resolver),e.promise},a}),define("ordnung/spa",["ordnung/spa/Outlet","ordnung/spa/applyViewModels","ordnung/spa/hashNavigation","ordnung/spa/Templates","ordnung/utils"],function(t,e,n,r,a){function i(t){return d.unloadCurrentPage(),d.setPageContent(t),d.setDocumentTitle(d.getPageTitle()||f),d.extractAndRunPageJavaScript(),e(d.element,u)}function o(t){return d.indicatePageIsLoading(),s(),h.getTemplate(t).then(i).then(function(){d.pageHasLoaded()})}function s(){for(var t;t=v.pop();)t()}function u(t,e){v.push(function(){t.dont(e)}),t(e)}function c(i,s){return l=s||window.document,p=a.extend(p,i),d=new t(l.querySelector("[data-outlet]"),l),f=s.title,h=new r(l,p),e(l,u).then(function(){n.start(p,o,l)})}var l,d,f,h,p={index:"index"},v=[];return{start:c}}),define("ordnung/proclaimWhen",[],function(){function t(t,e,n){e.subscribers.forEach(function(t){t.apply(t,n)})}function e(t,e,n){e.subscribers.push(n)}function n(t,e,n){var r=e.subscribers.indexOf(n);e.subscribers.splice(r,1)}function r(r,a){a.subscribers=[];var i=function(){1==arguments.length&&"function"==typeof arguments[0]?e(r,a,arguments[0]):t(r,a,arguments)};return i.dont=function(t){n(r,a,t)},i}function a(t){for(var e in t)t[e]=r(e,t[e]);return t}function i(t,e){return e?r(t,e):r("anonymous event",t)}return{extend:a,create:i}});
//# sourceMappingURL=ordnung.js.map